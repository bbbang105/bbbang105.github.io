---
date: 2024-11-03
tags:
  - springboot
  - backend
  - security
---

---

í˜„ì¬ íì‹œì¦˜ì—ì„œ í•˜ê³  ìˆëŠ” ë°‹ì—… í”„ë¡œì íŠ¸ HitZoneì—ì„œëŠ”,
ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ì„œ ì—ëŸ¬ë¥¼ ì¡ê³  ìˆë‹¤.

í•˜ì§€ë§Œ ì§€ì‹ì´ ë¶€ì¡±í•˜ì—¬ ì´ˆê¸°ì—ëŠ” ì—ëŸ¬ë¥¼ ì œëŒ€ë¡œ ì²˜ë¦¬í•˜ì§€ ëª» í–ˆëŠ”ë°,
ì´ë¥¼ ì–´ë–»ê²Œ ê°œì„ í•  ìˆ˜ ìˆì—ˆëŠ”ì§€ ì‘ì„±í•´ë³´ë ¤ê³  í•œë‹¤.

> ğŸŒ **í™˜ê²½**
Spring Boot : 3.3.4
Java : JDK 17

---

# ğŸŒ ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬

## GlobalExceptionHandler

```java
...

@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler extends ResponseEntityExceptionHandler {

    // ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(CustomException.class)
    public ResponseEntity<ApiResponse<ErrorReasonDto>> handleCustomException(CustomException e) {
        logError(e.getMessage(), e);
        return ApiResponse.onFailure(e.getErrorCode());
    }

    // Security ì¸ì¦ ê´€ë ¨ ì²˜ë¦¬
    @ExceptionHandler(SecurityException.class)
    public ResponseEntity<ApiResponse<ErrorReasonDto>> handleSecurityException(SecurityException e) {
        logError(e.getMessage(), e);
        return ApiResponse.onFailure(ErrorStatus._UNAUTHORIZED);
    }
    
...
```

ìš°ë¦¬ëŠ” ìœ„ì™€ ê°™ì´ GlobalExceptionHandler í´ë˜ìŠ¤ë¥¼ ë‘ê³ ,
`@RestControllerAdvice` ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì„ìœ¼ë¡œì¨ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì‹œì‘ë˜ì–´ ë°œìƒí•˜ëŠ” ëª¨ë“  ì—ëŸ¬ë¥¼ ì¡ìœ¼ë ¤ í•˜ì˜€ë‹¤.

ì—¬ê¸°ì„œ `RestControllerAdvice`ì™€ `ControllerAdvice`ì˜ ì°¨ì´ì ì„ ì ê¹ë§Œ ì¡ê³  ê°€ìë©´,

> ğŸ§‘ğŸ»â€ğŸ’» `RestControllerAdvice`ëŠ” `ControllerAdvice + ResponseBody`ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë¦¬í„´í•˜ëŠ” ê°’ì´ ì‘ë‹µê°’ì˜ bodyë¡œ ì„¸íŒ…ë˜ì–´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬ëœë‹¤. `ControllerAdvice`ë¥¼ ì‚¬ìš©í•˜ê³ , `ResponseBody` ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ ë™ì¼í•˜ê²Œ ë™ì‘í•œë‹¤ê³  í•˜ë‚˜, ê·¸ê²ƒë³´ë‹¤ëŠ” ì²˜ìŒë¶€í„° `RestControllerAdvice`ë¥¼ ì‚¬ìš©í•˜ëŠ” í¸ì´ ë‚«ë‹¤ê³  ì—¬ê²¨ ë§ì´ ì‚¬ìš©í•œë‹¤ê³  í•œë‹¤.
ìì„¸í•œ ë‚´ìš©ì€ [ë§í¬](https://medium.com/sjk5766/restcontrolleradvice-vs-controlleradvice-%EC%A0%95%EB%A6%AC-1591010ce0b0)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ë™ì‘ ê³¼ì •

ì´ì— ëŒ€í•œ ë™ì‘ ê³¼ì •ì„ í•œ ë²ˆ ë”°ë¼ê°„ë‹¤ë©´ ì¡°ê¸ˆ ë” ì´í•´ê°€ ì˜ ë  ë“¯í•˜ë‹¤.

### BaseErrorCode

```java
package kusitms.backend.global.code;

import kusitms.backend.global.dto.ErrorReasonDto;

public interface BaseErrorCode {
    ErrorReasonDto getReason();
    ErrorReasonDto getReasonHttpStatus();
}
```

ì¸í„°í˜ì´ìŠ¤ê°€ ìˆë‹¤.
ì—¬ê¸°ì„œëŠ” `ErrorReasonDto`ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œë¥¼ ì •ì˜í•œë‹¤.

### ErrorReasonDto

```java
package kusitms.backend.global.dto;

import lombok.Builder;
import lombok.Getter;
import org.springframework.http.HttpStatus;

@Getter
@Builder
public class ErrorReasonDto {
    private HttpStatus httpStatus;
    private final boolean isSuccess;
    private final String code;
    private final String message;
}
```

ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œì˜ ì‘ë‹µê°’ì´ë‹¤.
1) HTTP Status (400, 404 ë“±..)
2) isSuccess (ì„±ê³µì—¬ë¶€)
3) code (ì»¤ìŠ¤í…€ ì—ëŸ¬ ì½”ë“œ)
4) message (ì»¤ìŠ¤í…€ ì—ëŸ¬ ë©”ì„¸ì§€)

### ChatbotErrorStatus

```java
package kusitms.backend.chatbot.status;

import kusitms.backend.global.code.BaseErrorCode;
import kusitms.backend.global.dto.ErrorReasonDto;
import lombok.Getter;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;

@Getter
@RequiredArgsConstructor
public enum ChatbotErrorStatus implements BaseErrorCode {

    _NOT_FOUND_GUIDE_CHATBOT_ANSWER(HttpStatus.NOT_FOUND, "CHATBOT-001", "ì±—ë´‡ ë‹µë³€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."),
    _IS_NOT_VALID_CATEGORY_NAME(HttpStatus.BAD_REQUEST, "CHATBOT-002", "ì˜¬ë°”ë¥¸ ì¹´í…Œê³ ë¦¬ëª…ì´ ì•„ë‹™ë‹ˆë‹¤.")
    ;

    private final HttpStatus httpStatus;
    private final String code;
    private final String message;

    @Override
    public ErrorReasonDto getReason() {
        return ErrorReasonDto.builder()
                .isSuccess(false)
                .code(code)
                .message(message)
                .build();
    }

    @Override
    public ErrorReasonDto getReasonHttpStatus() {
        return ErrorReasonDto.builder()
                .isSuccess(false)
                .httpStatus(httpStatus)
                .code(code)
                .message(message)
                .build();
    }
}
```

ìœ„ì—ì„œ ì •ì˜í•œ BaseErrorCode ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” ê³³ì´ë‹¤.
í´ë˜ìŠ¤ëª…ì€ `{ë„ë©”ì¸}ErrorStatus` ë¡œ ë§Œë“¤ê³  ìˆë‹¤. `Auth`ë¼ë©´ `AuthErrorStatus`ì™€ ê°™ì€ ë°©ì‹ì´ë‹¤.

Enum í´ë˜ìŠ¤ë¡œ, ë³´ì´ëŠ” ê²ƒì²˜ëŸ¼ ë‚´ë¶€ì— ë‹¤ì–‘í•œ ê°’ë“¤ì„ ì»¤ìŠ¤í…€í•  ìˆ˜ ìˆë‹¤.
HTTP Status, ì½”ë“œ, ë©”ì„¸ì§€ë¥¼ ê°€ëŠ¥í•œ í•œ ì¹œì ˆí•˜ê²Œ êµ¬ì„±í•œë‹¤.

isSuccess í•„ë“œì—ëŠ” ë‹¹ì—°í•˜ê²Œë„ `false`ë§Œ ë“¤ì–´ê°€ê²Œ ëœë‹¤.

### CustomException

```java
package kusitms.backend.global.exception;

import kusitms.backend.global.code.BaseErrorCode;
import lombok.Getter;
import lombok.RequiredArgsConstructor;
import org.springframework.http.HttpStatus;

@Getter
@RequiredArgsConstructor
public class CustomException extends RuntimeException {
    private final BaseErrorCode errorCode;

    @Override
    public String getMessage() {
        return errorCode.getReasonHttpStatus().getMessage();
    }

    public String getCode() {
        return errorCode.getReasonHttpStatus().getCode();
    }

    public HttpStatus getHttpStatus() {
        return errorCode.getReasonHttpStatus().getHttpStatus();
    }
}
```

ê¸°ë³¸ì ìœ¼ë¡œ ì •í•´ì ¸ ìˆëŠ” ì—ëŸ¬ë¥¼ ì œì™¸í•œ,
ìš°ë¦¬ í”„ë¡œì íŠ¸ì˜ ë¡œì§ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì—ëŸ¬ë“¤ì€ ëª¨ë‘ `CustomException`ìœ¼ë¡œ ì§€ì •í•œë‹¤.

ê¸°ì¡´ì—ëŠ” `AuthException`, `ChatbotException`ê³¼ ê°™ì´ ë„ë©”ì¸ ë³„ë¡œ ë‚˜ëˆ„ì—ˆì—ˆëŠ”ë°,
í´ë˜ìŠ¤ë§Œ ëŠ˜ì–´ë‚  ë¿ íš¨ìš©ì„±ì„ ëŠë¼ì§€ ëª» í•´ì„œ í•˜ë‚˜ë¡œ í†µì¼í•˜ê²Œ ë˜ì—ˆë‹¤.
ì´ë¥¼ ë¨¼ì € ìƒê°í•´ì„œ ë§Œë“¤ì–´ ì¤€ íŒ€ì› ì¤€í˜•ì´í˜• ğŸ‘ğŸ»

`CustomException` ë‚´ì—ëŠ” ë¶ˆë³€ì„±ì„ ë„ëŠ” `BaseErrorCode` í•„ë“œê°€ 1ê°œ ì¡´ì¬í•œë‹¤.

ì´ì œ ì§€ê¸ˆê¹Œì§€ ë§Œë“  í´ë˜ìŠ¤ë“¤ë¡œ ì–´ë–»ê²Œ ì—ëŸ¬ë¥¼ ë˜ì§€ê³  ì²˜ë¦¬í•˜ëŠ” ì§€ ì•Œì•„ë³´ë„ë¡ í•˜ê² ë‹¤.

### Service ë‹¨

```java
...

   // ê°€ì´ë“œ ì±—ë´‡ ë‹µë³€ì„ ì¡°íšŒí•˜ëŠ” ë©”ì„œë“œ
    public GetGuideChatbotAnswerResponse getGuideChatbotAnswer(String stadiumName, String categoryName, int orderNumber) {
        switch (categoryName) {
            case "stadium":
                return getAnswersByOrderAndStadium(orderNumber, stadiumName, StadiumGuideAnswer.values());

            case "baseball":
                return getAnswersByOrderAndStadium(orderNumber, stadiumName, BaseballGuideAnswer.values());

            case "manner":
                return getAnswersByOrderAndStadium(orderNumber, stadiumName, MannerGuideAnswer.values());

            case "facility":
                return getAnswersByOrderAndStadium(orderNumber, stadiumName, FacilityGuideAnswer.values());

            case "parking":
                return getAnswersByOrderAndStadium(orderNumber, stadiumName, ParkingGuideAnswer.values());

            default:
                throw new CustomException(ChatbotErrorStatus._IS_NOT_VALID_CATEGORY_NAME);
        }
    }

...
```

ì„œë¹„ìŠ¤ ë¡œì§ìœ¼ë¡œ, íŒŒë¼ë¯¸í„°ì— ë§ê²Œ ê°€ì´ë“œ ì±—ë´‡ ë‹µë³€ì„ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œì´ë‹¤.
categoryNameì´ case êµ¬ë¬¸ì—ì„œ ê±¸ë¦¬ì§€ ì•ŠëŠ”ë‹¤ë©´, ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.

```java
throw new CustomException(ChatbotErrorStatus._IS_NOT_VALID_CATEGORY_NAME);
```

ìì„¸íˆ ë³´ë©´ CustomException ë‚´ì— ChatbotErrorStatusë¥¼ ë„£ì–´ ë˜ì§€ê³  ìˆë‹¤.

```java
_IS_NOT_VALID_CATEGORY_NAME(HttpStatus.BAD_REQUEST, "CHATBOT-002", "ì˜¬ë°”ë¥¸ ì¹´í…Œê³ ë¦¬ëª…ì´ ì•„ë‹™ë‹ˆë‹¤.")
```

ìœ„ì—ì„œ ë§í•œ ê²ƒì²˜ëŸ¼ ê° ìƒí™©ì— ë§ëŠ” ì»¤ìŠ¤í…€ ì—ëŸ¬ Statusë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì´ë‹¤.

### GlobalExceptionHandler - handleCustomException

```java
	// ì»¤ìŠ¤í…€ ì˜ˆì™¸ ì²˜ë¦¬
    @ExceptionHandler(CustomException.class)
    public ResponseEntity<ApiResponse<ErrorReasonDto>> handleCustomException(CustomException e) {
        logError(e.getMessage(), e);
        return ApiResponse.onFailure(e.getErrorCode());
    }
```

ì—¬ê¸°ì„œ ë˜ì ¸ì§„ ì—ëŸ¬ëŠ” GlobalExceptionHandlerê°€ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ê²Œ ëœë‹¤.
ì´ì œ ì´ ë©”ì„œë“œë¥¼ í•˜ë‚˜ì”© ëœ¯ì–´ ë³´ì.

```java
@ExceptionHandler(CustomException.class)
```

í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì€ handleCustomException ë©”ì„œë“œê°€ CustomExceptionì„ ì²˜ë¦¬í•˜ë„ë¡ ì§€ì •í•œë‹¤.

```java
logError(e.getMessage(), e);
```

ì´ëŠ” ì—ëŸ¬ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ëŠ” ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ë‹¤.

```java
   // ë¡œê·¸ ê¸°ë¡ ë©”ì„œë“œ
    private void logError(String message, Object errorDetails) {
        log.error("{}: {}", message, errorDetails);
    }
```

ìœ„ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë‚´ë¶€ì ìœ¼ë¡œ ì—ëŸ¬ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ê³ , ê°œë°œìê°€ ë³´ê³  í•´ê²°í•  ìˆ˜ ìˆë„ë¡ ë„ì›€ì„ ì¤€ë‹¤.

```java
return ApiResponse.onFailure(e.getErrorCode());
```

`ApiResponse` í´ë˜ìŠ¤ì˜ `onFailure` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

### ApiResponse - onFailure ë©”ì„œë“œ

```java
package kusitms.backend.global.dto;

import com.fasterxml.jackson.annotation.JsonInclude;
import kusitms.backend.global.code.BaseCode;
import kusitms.backend.global.code.BaseErrorCode;
import lombok.Getter;
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;

@Getter
@RequiredArgsConstructor
public class ApiResponse<T> {
    private final Boolean isSuccess;
    private final String code;
    private final String message;
    @JsonInclude(JsonInclude.Include.NON_NULL)
    private final T payload;

    public static <T> ResponseEntity<ApiResponse<T>> onSuccess(BaseCode code, T payload) {
        ApiResponse<T> response = new ApiResponse<>(true, code.getReasonHttpStatus().getCode(), code.getReasonHttpStatus().getMessage(), payload);
        return ResponseEntity.status(code.getReasonHttpStatus().getHttpStatus()).body(response);
    }

    public static <T> ResponseEntity<ApiResponse<T>> onSuccess(BaseCode code) {
        ApiResponse<T> response = new ApiResponse<>(true, code.getReasonHttpStatus().getCode(), code.getReasonHttpStatus().getMessage(), null);
        return ResponseEntity.status(code.getReasonHttpStatus().getHttpStatus()).body(response);
    }

    public static <T> ResponseEntity<ApiResponse<T>> onFailure(BaseErrorCode code) {
        ApiResponse<T> response = new ApiResponse<>(false, code.getReasonHttpStatus().getCode(), code.getReasonHttpStatus().getMessage(), null);
        return ResponseEntity.status(code.getReasonHttpStatus().getHttpStatus()).body(response);
    }
```

`ApiResponse`ëŠ” ëª¨ë“  ì‘ë‹µ í˜•ì‹ì„ í†µì¼í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ì´ë‹¤.
1) isSuccess (ì„±ê³µì—¬ë¶€)
2) code (ì»¤ìŠ¤í…€ ì½”ë“œ)
3) message (ì»¤ìŠ¤í…€ ë©”ì„¸ì§€)
4) payload (ë°ì´í„° ê°’)

ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆê³ , 
ì„±ê³µí–ˆì„ ë•ŒëŠ” `onSuccess`ë¥¼ ì‹¤íŒ¨í–ˆì„ ë•ŒëŠ” `onFailure` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µí•œë‹¤.

ì—¬ê¸°ì„œ `onFailure` ë©”ì„œë“œëŠ” BaseErrorCodeë¥¼ ì¸ìë¡œ ë°›ê³ ,
ì´ ì•ˆì— ìˆëŠ” ê°’ë“¤ì„ ê°€ì§€ê³  ì‘ë‹µì„ êµ¬ì„±í•´ ë°˜í™˜í•˜ê²Œ ëœë‹¤.

`ResponseEntity`ë¡œ í•œ ë²ˆ ë” ê°ì‹¸ê³  ë³´ë‚´ëŠ”ë°,
ì´ëŠ” HTTP Status ê¹Œì§€ ë°˜ì˜í•˜ê¸° ìœ„í•¨ì´ë‹¤.

### ì—ëŸ¬ ì‘ë‹µ í™”ë©´

![](https://velog.velcdn.com/images/hsh111366/post/b11e4d18-d6df-469e-a969-5b2c61da371e/image.png)

![](https://velog.velcdn.com/images/hsh111366/post/693de98b-949a-4755-b433-0574d261d5c6/image.png)

ìœ„ì²˜ëŸ¼ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì‘ë‹µì„ í™•ì¸í•  ìˆ˜ ìˆê³ , ë‚´ë¶€ì ìœ¼ë¡œ ë¡œê·¸ë„ ê¸°ë¡ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

---

ì§€ê¸ˆê¹Œì§€ ì–´ë–»ê²Œ ì»¤ìŠ¤í…€ ì—ëŸ¬ë¥¼ êµ¬ì„±í•˜ê³  ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ì§€ ì•Œì•„ë³´ì•˜ë‹¤.

ê¸€ì´ ìƒê°ë³´ë‹¤ ê¸¸ì–´ì ¸ì„œ, ì—¬ê¸°ì„œ ì¶”ê°€ì ìœ¼ë¡œ ê°œì„ í•œ ë¶€ë¶„ì€ ë‹¤ìŒ ê¸€ì—ì„œ ì‘ì„±í•´ë³´ë„ë¡ í•˜ê² ë‹¤! ğŸƒğŸ»

[ë‹¤ìŒ ê¸€](https://velog.io/@hsh111366/ì—ëŸ¬ë¥¼-ì¥ì¡ë“¯ì´-ì¡ì•„ë³´ì-2)
