---
date: 2025-05-02
tags:
  - springboot
  - backend
  - infra
---

---

# ğŸ¬ ì„œë¡ 

ì´ì „ë¶€í„° ë¡œê·¸ ê´€ë¦¬ì˜ ì¤‘ìš”ì„±ì€ ì•Œê³  ìˆì—ˆì§€ë§Œ, ê³„ì†í•´ì„œ ë‹¤ë¥¸ ê²ƒë“¤ì— ìš°ì„ ìˆœìœ„ê°€ ë°€ë¦¬ë‹¤ ë³´ë‹ˆ ì œëŒ€ë¡œ ë‹¤ë£¨ì§€ ëª» í–ˆì—ˆë‹¤.

í•˜ì§€ë§Œ [ì›íƒ€ì„](https://www.onetime-with-members.com/) ì„œë¹„ìŠ¤ì˜ ì‚¬ìš©ì ìˆ˜ê°€ ê³„ì†í•´ì„œ ëŠ˜ì–´ë‚˜ë©° ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ ê°œì„ ì˜ í•„ìš”ì„±ë„ í¬ê²Œ ëŠë¼ê²Œ ë˜ì—ˆê³ , ì´ë¥¼ ìœ„í•´ì„œ ìš°ì„  ë¡œê¹…ë¶€í„° ê°œì„ ì„ í•´ ë³´ê³ ì ê¸€ì„ ì ìœ¼ë ¤ í•œë‹¤.

---

# ğŸš¨ ê¸°ì¡´ ë¡œê·¸ ë¬¸ì œì 

```
2025-05-02T23:33:19.742+09:00  INFO 1 --- [nio-8090-exec-6] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
Hibernate: select u1_0.users_id,u1_0.created_date,u1_0.email,u1_0.language,u1_0.marketing_policy_agreement,u1_0.name,u1_0.nickname,u1_0.privacy_policy_agreement,u1_0.provider,u1_0.provider_id,u1_0.service_policy_agreement,u1_0.sleep_end_time,u1_0.sleep_start_time,u1_0.updated_date from users u1_0 where u1_0.users_id=?
Hibernate: select ep1_0.event_participations_id,ep1_0.created_date,ep1_0.events_id,ep1_0.event_status,ep1_0.updated_date,ep1_0.users_id from event_participations ep1_0 where ep1_0.users_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_uuid=?
Hibernate: select ep1_0.event_participations_id,ep1_0.created_date,ep1_0.events_id,ep1_0.event_status,ep1_0.updated_date,ep1_0.users_id from event_participations ep1_0 where ep1_0.events_id=?
Hibernate: select m1_0.events_id,m1_0.members_id,m1_0.created_date,m1_0.members_uuid,m1_0.name,m1_0.pin,m1_0.updated_date from members m1_0 where m1_0.events_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_uuid=?
Hibernate: select ep1_0.event_participations_id,ep1_0.created_date,ep1_0.events_id,ep1_0.event_status,ep1_0.updated_date,ep1_0.users_id from event_participations ep1_0 where ep1_0.events_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_uuid=?
Hibernate: select ep1_0.event_participations_id,ep1_0.created_date,ep1_0.events_id,ep1_0.event_status,ep1_0.updated_date,ep1_0.users_id from event_participations ep1_0 where ep1_0.events_id=?
Hibernate: select s1_0.selections_id,s1_0.created_date,s1_0.members_id,s2_0.schedules_id,s2_0.created_date,s2_0.date,s2_0.day,s2_0.events_id,s2_0.time,s2_0.updated_date,s1_0.updated_date,s1_0.users_id from selections s1_0 join schedules s2_0 on s2_0.schedules_id=s1_0.schedules_id where s2_0.events_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_uuid=?
Hibernate: select ep1_0.event_participations_id,ep1_0.created_date,ep1_0.events_id,ep1_0.event_status,ep1_0.updated_date,ep1_0.users_id from event_participations ep1_0 where ep1_0.events_id=?
Hibernate: select m1_0.events_id,m1_0.members_id,m1_0.created_date,m1_0.members_uuid,m1_0.name,m1_0.pin,m1_0.updated_date from members m1_0 where m1_0.events_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_uuid=?
Hibernate: select ep1_0.event_participations_id,ep1_0.created_date,ep1_0.events_id,ep1_0.event_status,ep1_0.updated_date,ep1_0.users_id from event_participations ep1_0 where ep1_0.events_id=?
Hibernate: select e1_0.events_id,e1_0.category,e1_0.created_date,e1_0.end_time,e1_0.events_uuid,e1_0.qr_file_name,e1_0.start_time,e1_0.title,e1_0.updated_date from events e1_0 where e1_0.events_uuid=?
Hibernate: select ep1_0.event_participations_id,ep1_0.created_date,ep1_0.events_id,ep1_0.event_status,ep1_0.updated_date,ep1_0.users_id from event_participations ep1_0 where ep1_0.events_id=?
Hibernate: select s1_0.selections_id,s1_0.created_date,s1_0.members_id,s2_0.schedules_id,s2_0.created_date,s2_0.date,s2_0.day,s2_0.events_id,s2_0.time,s2_0.updated_date,s1_0.updated_date,s1_0.users_id from selections s1_0 join schedules s2_0 on s2_0.schedules_id=s1_0.schedules_id where s2_0.events_id=?
```

ê¸°ì¡´ì˜ ì¡°ì•…í•œ ë¡œê·¸ë¥¼ ë³´ì. ì—¬ê¸°ì—ëŠ” ì•„ë˜ì˜ ë¬¸ì œì ë“¤ì´ ì¡´ì¬í•œë‹¤.

> **1. SQLë¬¸ì´ ëª¨ë‘ ì¶œë ¥ë¨**
- ë¶ˆí•„ìš”í•œ ì •ë³´ê°€ ê³¼ë„í•˜ê²Œ ìŒ“ì´ë©´ì„œ ë¡œê·¸ ë¶„ì„ì´ ì–´ë ¤ì›Œì§ˆ ë¿ë§Œ ì•„ë‹ˆë¼, ë¡œê·¸ íŒŒì¼ ìš©ëŸ‰ë„ ë¹ ë¥´ê²Œ ì¦ê°€í•¨

> **2. ì–´ë–¤ APIì¸ì§€ ì•Œ ìˆ˜ ì—†ìŒ**
- Hibernate ì¿¼ë¦¬ë§Œ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— ìš”ì²­í•œ API ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ê°€ ì „í˜€ ë³´ì´ì§€ ì•ŠìŒ.
- ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ê°€ ì–´ë–¤ ìš”ì²­ì„ ë³´ëƒˆëŠ”ì§€, ì–´ë–¤ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì²˜ë¦¬ëëŠ”ì§€ ì•Œ ìˆ˜ ì—†ì–´ ë””ë²„ê¹… ë° ë¬¸ì œ ì¬í˜„ì´ ì–´ë ¤ì›€.

> **3. ìš”ì²­ íŒŒë¼ë¯¸í„°, ì‚¬ìš©ì ì •ë³´ ì—†ìŒ**
- ì–´ë–¤ userId / eventIdì— ëŒ€í•œ ìš”ì²­ì¸ì§€ ì „í˜€ ë§¥ë½ì´ ì—†ìŒ.
- íŠ¹ì • ì‚¬ìš©ìì˜ ìš”ì²­ì´ì—ˆëŠ”ì§€, ê´€ë¦¬ìì˜ ìš”ì²­ì´ì—ˆëŠ”ì§€ êµ¬ë¶„ ë¶ˆê°€í•¨

> **4. ì²˜ë¦¬ ì‹œê°„ ë¡œê¹… ì—†ìŒ â†’ ë³‘ëª© íŒŒì•… ë¶ˆê°€**
- ì²˜ë¦¬ ì†ë„(time=xxxms)ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, 
1) ì–´ë–¤ ìš”ì²­ì´ ëŠë¦°ì§€ 
2) ì–´ë–¤ APIê°€ ë³‘ëª©ì¸ì§€ 
3) ì–´ë–¤ DB ì¿¼ë¦¬ê°€ ì„±ëŠ¥ì„ ì¡ì•„ë¨¹ëŠ”ì§€ ì „í˜€ íŒë‹¨í•  ìˆ˜ ì—†ìŒ.
- ë•Œë¬¸ì— ì„±ëŠ¥ ê°œì„  ë° ìŠ¤ì¼€ì¼ë§ íŒë‹¨ì´ ì–´ë ¤ì›€

ì§€ê¸ˆë¶€í„° ì—¬ê¸°ì— ìˆëŠ” ë¬¸ì œë“¤ì„ í•˜ë‚˜ì”© ê°œì„ í•´ë³´ê³ ì í•œë‹¤.

---

# ğŸ’£ ë¬¸ì œ1 - SQLë¬¸ì´ ëª¨ë‘ ì¶œë ¥ë¨

```yaml
server:
  port: ${SERVER_PORT}

spring:
  datasource:
    url: ${DATABASE_URL}
    username: ${DATABASE_USERNAME}
    password: ${DATABASE_PW}
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
    hibernate:
      ddl-auto: update

    defer-datasource-initialization: true
    open-in-view: false
    generate-ddl: true
    show-sql: true

  sql:
    init:
      mode: always

(ìƒëµ..)

```

ê¸°ì¡´ì—ëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ yaml íŒŒì¼ì´ êµ¬ì„±ë˜ì–´ ìˆì—ˆê¸° ë•Œë¬¸ì—, ëª¨ë“  SQLë¬¸ì´ ê·¸ëŒ€ë¡œ ì¶œë ¥ë˜ì—ˆë‹¤. 

ì´ëŠ” ë³´ê¸°ì—ë„ ì¢‹ì§€ ì•Šì„ ë¿ë§Œ ì•„ë‹ˆë¼, ë³´ì•ˆìƒ ì•ˆì „í•˜ì§€ ì•Šì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¡œì»¬ì—ì„œë§Œ ì¶œë ¥ë˜ë„ë¡ í•˜ê³  í…ŒìŠ¤íŠ¸ & ë°°í¬ ì„œë²„ì—ì„œëŠ” ì¶œë ¥ë˜ì§€ ì•Šë„ë¡ ë³€ê²½í•˜ì˜€ë‹¤.

## âœ… í•´ê²° ë°©ë²• - yaml íŒŒì¼ ë¶„ë¦¬

ë•Œë¬¸ì— yaml íŒŒì¼ì„ `1) ë¡œì»¬ 2) í…ŒìŠ¤íŠ¸ 3) ë°°í¬` ê°ê°ìœ¼ë¡œ ë¶„ë¦¬ë¥¼ í•˜ì˜€ê³ ,
í…ŒìŠ¤íŠ¸ì™€ ë°°í¬ ì„œë²„ì—ì„œëŠ” SQLë¬¸ì´ ì¶œë ¥ë˜ì§€ ì•Šë„ë¡ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í–ˆë‹¤.(ì£¼ì„ì€ ì œê±°)

```yaml
spring:
  jpa:
    show-sql: false  # âŒ SQL ì½˜ì†” ì¶œë ¥ ë”
    properties:
      hibernate:
        format_sql: false
        use_sql_comments: false  # âŒ ì£¼ì„ ì¶œë ¥ ë”
    hibernate:
      ddl-auto: validate  # âœ… ìš´ì˜í™˜ê²½ì—ì„œëŠ” ìŠ¤í‚¤ë§ˆë§Œ ê²€ì¦ (update â†’ validate)
    generate-ddl: false  # âŒ DDL ìë™ ìƒì„± ë”

  sql:
    init:
      mode: never  # âŒ schema.sql, data.sql ì‹¤í–‰ ì•ˆ í•¨

logging:
  level:
    org.hibernate.SQL: off  # âŒ Hibernate SQL ë¡œê·¸ ë”
    org.hibernate.type.descriptor.sql.BasicBinder: off  # âŒ SQL íŒŒë¼ë¯¸í„° ë¡œê·¸ ë”
```

ë˜í•œ ê°ê° í…ŒìŠ¤íŠ¸ì™€ ë°°í¬ í™˜ê²½ì´ë¼ëŠ” ê²ƒì„ ì¸ì‹í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ë„ì»¤ ì»¨í…Œì´ë„ˆë¥¼ ë„ìš¸ ë•Œ ì•„ë˜ì™€ ê°™ì´ ë„ì»¤ ì»´í¬ì¦ˆì— `SPRING_PROFILES_ACTIVE` í™˜ê²½ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ì—¬ ì£¼ì…í•´ì£¼ì—ˆë‹¤.

```yaml
    environment:
      - TZ=Asia/Seoul
      - SPRING_PROFILES_ACTIVE=prod
```

## ğŸ’« ê²°ê³¼

```
2025-05-03T00:56:15.988+09:00 ERROR 1 --- [nio-8090-exec-8] side.onetime.global.config.JwtFilter     : JWT validation failed: Cannot invoke "String.substring(int)" because "authorizationHeader" is null
2025-05-03T00:56:16.278+09:00  INFO 1 --- [nio-8090-exec-7] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:56:16.308+09:00  INFO 1 --- [nio-8090-exec-7] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:56:16.350+09:00  INFO 1 --- [nio-8090-exec-3] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:56:16.399+09:00  INFO 1 --- [nio-8090-exec-6] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:56:17.099+09:00  INFO 1 --- [nio-8090-exec-9] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:57:06.516+09:00  INFO 1 --- [nio-8090-exec-5] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:57:06.515+09:00  INFO 1 --- [io-8090-exec-10] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:57:06.525+09:00  INFO 1 --- [nio-8090-exec-8] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
2025-05-03T00:57:06.525+09:00  INFO 1 --- [nio-8090-exec-1] side.onetime.util.JwtUtil                : JWTë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.
```

ê·¸ ê²°ê³¼ ì´ëŸ°ì‹ìœ¼ë¡œ ë¡œê·¸ë¥¼ ì œì™¸í•˜ê³ ëŠ” SQLë¬¸ì´ ëœ¨ì§€ ì•Šê²Œ ë˜ì—ˆë‹¤.

---

# ğŸ’£ ë¬¸ì œ2 - ì–´ë–¤ APIì¸ì§€ ì•Œ ìˆ˜ ì—†ìŒ & ì²˜ë¦¬ ì‹œê°„ ë¡œê¹… ì—†ìŒ

í˜„ì¬ë¡œì¨ëŠ” ì–´ë– í•œ API í˜¸ì¶œì´ ì¼ì–´ë‚¬ëŠ”ì§€ë¥¼ ì•Œ ìˆ˜ê°€ ì—†ê¸°ì—, ë§Œì•½ 500ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°ì—ëŠ” í•´ë‹¹ ìƒí™©ì„ ì •í™•íˆ íŒŒì•…í•˜ê¸°ê°€ ë§¤ìš° ì–´ë µë‹¤.

ë•Œë¬¸ì— ëª¨ë“  API í˜¸ì¶œì— ëŒ€í•´ì„œ ë¡œê¹…ì„ ì§„í–‰í•´ë³´ë ¤ í•œë‹¤.


## âœ… í•´ê²° ë°©ë²• - ì¸í„°ì…‰í„° êµ¬í˜„

ë¡œê¹…ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆì§€ë§Œ, ì•„ë˜ì˜ 3ê°€ì§€ ë°©ë²• ì¤‘ì—ì„œ ê³ ë¯¼ì„ í–ˆë‹¤.

> **1. Filter**
- ì¥ì  : ê°€ì¥ í•˜ìœ„ë ˆë²¨ì—ì„œ ë™ì‘(ë””ìŠ¤íŒ¨ì²˜ì„œë¸”ë › ì´ì „)í•˜ê¸° ë•Œë¬¸ì— API ë¿ë§Œ ì•„ë‹ˆë¼ ì •ì  ë¦¬ì†ŒìŠ¤ ìš”ì²­ê³¼ ê°™ì€ í˜¸ì¶œì— ëŒ€í•´ì„œë„ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•¨.
- ë‹¨ì  : í•˜ì§€ë§Œ ì–´ë– í•œ API í˜¸ì¶œì¸ì§€, ì–´ë–¤ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ íƒ€ê³  ê°€ëŠ”ì§€ ë“±ì˜ ë””í…Œì¼í•œ ì •ë³´ëŠ” íŒŒì•…í•˜ê¸°ê°€ ì–´ë ¤ì›€.
- [ì •ë¦¬ ê¸€](https://velog.io/@hsh111366/Spring-Filterë€)

> **2. Interceptor**
- ì¥ì  : Spring MVC ë ˆì´ì–´ì— ì†í•˜ë©°, ì»¨íŠ¸ë¡¤ëŸ¬ ìš”ì²­ ì „í›„ì˜ ë¡œì§ì„ ì²˜ë¦¬í•˜ê¸°ì— ì í•©í•¨. ë˜í•œ ìš”ì²­ê³¼ ì‘ë‹µ ì •ë³´ê¹Œì§€ ë‹¤ë£° ìˆ˜ ìˆê¸°ì— ë””í…Œì¼í•œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•¨.
- ë‹¨ì  : ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨, ì¦‰ API ìš”ì²­ì— ëŒ€í•´ì„œë§Œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ê¸°ì—, ì •ì  ë¦¬ì†ŒìŠ¤ ìš”ì²­ì— ëŒ€í•´ì„œëŠ” ì²˜ë¦¬í•´ì¤„ ìˆ˜ ì—†ìŒ.
- [ì •ë¦¬ ê¸€](https://velog.io/@hsh111366/Spring-Interceptorë€)

> **3. AOP(Aspect-Oriented Programming)**
- ì¥ì  : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë³„ê°œë¡œ ê³µí†µ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬í•˜ì—¬ ëª¨ë“ˆí™” í•  ìˆ˜ ìˆê¸°ì—, ê¹”ë”í•œ ê´€ë¦¬ê°€ ê°€ëŠ¥í•¨. API ë¿ë§Œ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ë©”ì„œë“œ í˜¸ì¶œ ì „ í›„ì— í•„ìš”í•œ ë¡œì§ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•  ìˆ˜ ìˆìŒ.
- ë‹¨ì  : 	HTTP ìš”ì²­/ì‘ë‹µ ê°ì²´ì— ì§ì ‘ ì ‘ê·¼í•˜ê¸° ì–´ë ¤ì›Œ, ìš”ì²­ ë°”ë””ë‚˜ ì‘ë‹µ ë°”ë””ë¥¼ ì½ê±°ë‚˜ ê°€ê³µí•˜ëŠ” ì¼ì€ ê±°ì˜ ë¶ˆê°€ëŠ¥ì— ê°€ê¹Œì›€. ë˜í•œ ìš”ì²­ ì²˜ë¦¬ ì†ë„ë¥¼ íŒŒì•…í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, ì¸í„°ì…‰í„°ì— ë¹„í•´ ì •í™•ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìŒ.

ê²°ê³¼ì ìœ¼ë¡œ ìš”ì²­ & ì‘ë‹µ ë°ì´í„° ê°€ê³µì´ ê°€ëŠ¥í•˜ê³ , ì •í™•í•œ API ìš”ì²­ ì²˜ë¦¬ ì†ë„ë¥¼ ê³„ì‚°í•  ìˆ˜ ìˆëŠ” `ì¸í„°ì…‰í„°`ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒìœ¼ë¡œ ê²°ì •í•˜ê²Œ ë˜ì—ˆë‹¤.

### ê°€. ì˜ì¡´ì„± ì¶”ê°€

```gradle
	// Web
    implementation 'org.springframework.boot:spring-boot-starter-web'
    // Lombok
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
```

ì¸í„°ì…‰í„°ì™€ ë¡œê¹…ì„ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ìœ„ ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•œë‹¤.

### ë‚˜. LoggingInterceptor í´ë˜ìŠ¤ êµ¬í˜„

```java
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;

@Slf4j
@Component
public class LoggingInterceptor implements HandlerInterceptor {

    private static final String START_TIME = "startTime";

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        long now = System.currentTimeMillis();
        request.setAttribute(START_TIME, now);

        log.info("â¡ï¸ [{}] {} ìš”ì²­ ì‹œì‘", request.getMethod(), request.getRequestURI());
        return true;
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        Long start = (Long) request.getAttribute(START_TIME);
        long duration = System.currentTimeMillis() - (start != null ? start : 0L);

        int status = response.getStatus();

        log.info("âœ… [{}] {} ìš”ì²­ ì™„ë£Œ - {}ms | status={}", request.getMethod(), request.getRequestURI(), duration, status);
    }
}
```

ë¡œê¹…ì„ ìœ„í•œ ì¸í„°ì…‰í„° í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.

ì—¬ê¸°ì„œ `preHandle` ë©”ì„œë“œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œ ì§ì „ì— ë™ì‘í•œë‹¤. ì—¬ê¸°ì„œ ìš”ì²­ ì²˜ë¦¬ ì†ë„ ê³„ì‚°ì„ ìœ„í•œ ì‹œì‘ ì‹œê°„ `now`ë¥¼ ì„¤ì •í•´ ì£¼ê³ , ì–´ë– í•œ ë©”ì„œë“œ & URIì¸ì§€ë¥¼ ë¡œê·¸ë¡œ ì°ì–´ì¤€ë‹¤.

ì´í›„ ì»¨íŠ¸ë¡¤ëŸ¬ í˜¸ì¶œì´ ì¢…ë£Œë˜ê³  ë¡œì§ì´ ì§„í–‰ëœ í›„, `afterCompletion` ë©”ì„œë“œê°€ ë™ì‘í•˜ì—¬ ì²˜ë¦¬ ì†ë„ `duration`ê³¼ ìƒíƒœ ì½”ë“œ `status`ë¥¼ ë¡œê·¸ë¡œ ì°ì–´ì£¼ëŠ” êµ¬ì¡°ì´ë‹¤.

### ë‹¤. WebConfig í´ë˜ìŠ¤ êµ¬í˜„

```java
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import side.onetime.global.interceptor.LoggingInterceptor;

@Configuration
@RequiredArgsConstructor
public class WebConfig implements WebMvcConfigurer {

    private final LoggingInterceptor loggingInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loggingInterceptor)
                .addPathPatterns("/**");
    }
}
```

ë§Œë“¤ì—ˆë‹¤ê³  ë°”ë¡œ ì ìš©ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.
ìœ„ì—ì„œ ë§Œë“  ì¸í„°ì…‰í„° beanì„ `WebMvcConfigurer`ë¥¼ êµ¬í˜„í•œ `WebConfig`ì— ë“±ë¡í•´ì£¼ì–´ì•¼ í•œë‹¤.

í˜„ì¬ëŠ” ëª¨ë“  API í˜¸ì¶œì— ëŒ€í•´ ì ìš©í•  ê²ƒì´ê¸° ë•Œë¬¸ì—, `"/**"`ë¡œ ë‘ì—ˆë‹¤. ì´ëŠ” ìƒí™©ì— ë”°ë¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥í•˜ë‹¤.


## ğŸ’« ê²°ê³¼

![](https://velog.velcdn.com/images/hsh111366/post/98eefc30-c09c-426b-a52a-05aa4de7cd1b/image.png)

ì´ë ‡ê²Œ API í˜¸ì¶œì„ í•  ë•Œ ì–´ë–¤ APIì¸ì§€ & ìš”ì²­ ì²˜ë¦¬ ì†ë„ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤!

---

# ğŸ’£ ë¬¸ì œ3 - JWT ê²€ì¦ ë¡œì§ì´ ì¤‘ë³µë¨

ìœ„ì—ì„œë„ ë³¼ ìˆ˜ ìˆë“¯ì´ JWT ê²€ì¦ ë¡œì§ì´ ì´ìƒí•˜ê²Œ ì—¬ëŸ¬ ë²ˆ ëœ¨ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆì—ˆë‹¤.
ë¡œê¹…ê³¼ëŠ” ì¡°ê¸ˆ ê±°ë¦¬ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë‚˜, ê°œì„ í•˜ëŠ” ê¹€ì— ê°™ì´ í•´ë³´ë ¤ê³  í•œë‹¤.

ë‚˜ëŠ” í˜„ì¬ JwtFilter + Spring Securityë¥¼ ì´ìš©ì¤‘ì´ê¸°ì— ì´ë¥¼ íŒŒì•…í•´ë³´ì•˜ë‹¤.

### JwtFilter

```java
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;
import side.onetime.auth.service.CustomUserDetailsService;
import side.onetime.util.JwtUtil;

import java.io.IOException;

@Slf4j
@Component
@RequiredArgsConstructor
public class JwtFilter extends OncePerRequestFilter {

    private final JwtUtil jwtUtil;
    private final CustomUserDetailsService customUserDetailsService;

    /**
     * ìš”ì²­ì„ ì²˜ë¦¬í•˜ë©° JWT ê²€ì¦ ë° ì¸ì¦ ì„¤ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
     *
     * @param request     HTTP ìš”ì²­ ê°ì²´
     * @param response    HTTP ì‘ë‹µ ê°ì²´
     * @param filterChain  í•„í„° ì²´ì¸ ê°ì²´
     * @throws ServletException ì„œë¸”ë¦¿ ì˜ˆì™¸ ë°œìƒ ì‹œ
     * @throws IOException      ì…ì¶œë ¥ ì˜ˆì™¸ ë°œìƒ ì‹œ
     */
    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
        try {
            if (request.getMethod().equalsIgnoreCase("OPTIONS")) {
                filterChain.doFilter(request, response);
                return;
            }
            String token = jwtUtil.getTokenFromHeader(request.getHeader("Authorization"));
            jwtUtil.validateToken(token);
            Long userId = jwtUtil.getClaimFromToken(token, "userId", Long.class);
            setAuthentication(userId);

        } catch (Exception e) {
            log.error("JWT validation failed: " + e.getMessage());
            SecurityContextHolder.clearContext();
        }
        filterChain.doFilter(request, response);
    }

    /**
     * ì¸ì¦ ì •ë³´ë¥¼ SecurityContextì— ì„¤ì •í•©ë‹ˆë‹¤.
     *
     * @param userId ì¸ì¦ëœ ì‚¬ìš©ìì˜ ID
     */
    private void setAuthentication(Long userId) {
        UserDetails userDetails = customUserDetailsService.loadUserByUserId(userId);
        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(
                userDetails,
                null,
                userDetails.getAuthorities()
        );
        SecurityContextHolder.getContext().setAuthentication(authentication);
    }

    /**
     * íŠ¹ì • ê²½ë¡œì— ëŒ€í•´ JWT ê²€ì¦ì„ ìƒëµí•©ë‹ˆë‹¤.
     *
     * @param request HTTP ìš”ì²­ ê°ì²´
     * @return trueì¼ ê²½ìš° í•´ë‹¹ ìš”ì²­ì— ëŒ€í•´ í•„í„°ë¥¼ ì ìš©í•˜ì§€ ì•ŠìŒ
     */
    @Override
    protected boolean shouldNotFilter(HttpServletRequest request) {
        String path = request.getServletPath();
        return path.startsWith("/api/v1/users/onboarding");
    }
}
```

í•´ë‹¹ í•„í„°ëŠ” ëª¨ë“  API ìš”ì²­ì— ëŒ€í•´ ë™ì‘í•œë‹¤. ë¡œì§ì€ ì•„ë˜ì™€ ê°™ë‹¤.

1. í—¤ë”ì—ì„œ í† í°ì„ êº¼ë‚¸ë‹¤.
2. í† í°ì„ ê²€ì¦í•œë‹¤.
3. ìœ ì € idë¥¼ claimì—ì„œ ì¶”ì¶œí•œë‹¤.
4. `setAuthentication` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.
5. `loadUserByUserId` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.

```java
    /**
     * ì‚¬ìš©ì IDë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
     *
     * ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì£¼ì–´ì§„ ì‚¬ìš©ì IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìë¥¼ ì¡°íšŒí•˜ê³ ,
     * CustomUserDetails ê°ì²´ë¡œ ë˜í•‘í•˜ì—¬ ë°˜í™˜í•©ë‹ˆë‹¤.
     *
     * @param userId ì‚¬ìš©ì ID
     * @return ì‚¬ìš©ì ìƒì„¸ ì •ë³´ (CustomUserDetails ê°ì²´)
     * @throws CustomException ì‚¬ìš©ì IDì— í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ìê°€ ì—†ì„ ê²½ìš° ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤.
     */
    public UserDetails loadUserByUserId(Long userId) throws UsernameNotFoundException {
        User user = userRepository.findById(userId)
                .orElseThrow(() -> new CustomException(UserErrorStatus._NOT_FOUND_USER_BY_USERID));
        return new CustomUserDetails(user);
    }
```

6. `CustomUserDetails` ê°ì²´ë¡œ ë˜í•‘í•˜ì—¬ ë°˜í™˜í•œë‹¤.

```java
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;
import side.onetime.domain.User;

import java.util.Collection;

public record CustomUserDetails(User user) implements UserDetails {

    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        return null;
    }

    @Override
    public String getPassword() {
        return null;
    }

    @Override
    public String getUsername() {
        return user.getName();
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }

    public Long getId() {
        return user.getId();
    }

    public String getEmail() {
        return user.getEmail();
    }
}

```

7. `UsernamePasswordAuthenticationToken`ì— í•´ë‹¹ ê°ì²´ë¥¼ ë„£ê³  ë§ì•„ì„œ `SecurityContext`ì— ì„¤ì •í•œë‹¤.

8. ì´í›„ í”„ë ˆì  í…Œì´ì…˜ or ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆì´ì–´ì—ì„œ í•´ë‹¹ ì»¨í…ìŠ¤íŠ¸ì— ìˆëŠ” ìœ ì € ê°ì²´ë¥¼ êº¼ë‚´ ì‚¬ìš©í•œë‹¤.

ì´ëŸ¬í•œ ìœ„ ë¡œì§ì€ ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  HTTP ìš”ì²­ì— ëŒ€í•´ì„œ ì ìš©ë˜ê³  ìˆë‹¤. 
ë‹¤ë§Œ OPTIONS ìš”ì²­ê³¼ `shouldNotFilter`ì— ë“±ë¡í•´ ë‘” URIì¸ `/api/v1/users/onboarding`ì— ëŒ€í•´ì„œëŠ” ì œì™¸ëœë‹¤.

í•´ë‹¹ URIë§Œ ì œì™¸í•´ ë‘” ì´ìœ ëŠ”, UserControllerë¡œ ë“¤ì–´ì˜¤ëŠ” APIë“¤ ì¤‘ `/api/v1/users/onboarding`ë§Œ ì¸ì¦ì´ í•„ìš”ì—†ê¸° ë•Œë¬¸ì´ì—ˆë‹¤.

```java
    /**
     * ìœ ì € ì •ë³´ ì¡°íšŒ API.
     *
     * ë¡œê·¸ì¸í•œ ìœ ì €ì˜ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
     *
     * @param customUserDetails ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´
     * @return ìœ ì €ì˜ ì •ë³´ë¥¼ í¬í•¨í•œ ì‘ë‹µ ê°ì²´
     */
    @GetMapping("/profile")
    public ResponseEntity<ApiResponse<GetUserProfileResponse>> getUserProfile(
            @AuthenticationPrincipal CustomUserDetails customUserDetails) {

        GetUserProfileResponse getUserProfileResponse = userService.getUserProfile(customUserDetails.user());
        return ApiResponse.onSuccess(SuccessStatus._GET_USER_PROFILE, getUserProfileResponse);
    }
```

ê·¸ë ‡ê¸°ì— UserControllerì—ì„œëŠ” ìœ„ì™€ ê°™ì´ `@AuthenticationPrincipal CustomUserDetails customUserDetails`ë¥¼ í†µí•´ì„œ Contextì— ìˆëŠ” ìœ ì € ê°ì²´ë¥¼ ì •ìƒì ìœ¼ë¡œ ê°€ì ¸ì™€ í™œìš©í•˜ê³  ìˆì—ˆë‹¤.

```java
    /**
     * ìœ ì € ì°¸ì—¬ ì´ë²¤íŠ¸ ëª©ë¡ ì¡°íšŒ API.
     *
     * ì´ APIëŠ” ì¸ì¦ëœ ìœ ì €ê°€ ì°¸ì—¬í•œ ëª¨ë“  ì´ë²¤íŠ¸ ëª©ë¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤. ìœ ì €ì˜ ì°¸ì—¬ ìƒíƒœ, ì´ë²¤íŠ¸ ì •ë³´ ë“±ì´ í¬í•¨ë©ë‹ˆë‹¤.
     *
     * @param authorizationHeader ì¸ì¦ëœ ìœ ì €ì˜ í† í°
     * @return ìœ ì €ê°€ ì°¸ì—¬í•œ ì´ë²¤íŠ¸ ëª©ë¡
     */
    @GetMapping("/user/all")
    public ResponseEntity<ApiResponse<List<GetUserParticipatedEventsResponse>>> getUserParticipatedEvents(
            @RequestHeader("Authorization") String authorizationHeader) {

        List<GetUserParticipatedEventsResponse> getUserParticipatedEventsResponses = eventService.getUserParticipatedEvents(authorizationHeader);
        return ApiResponse.onSuccess(SuccessStatus._GET_USER_PARTICIPATED_EVENTS, getUserParticipatedEventsResponses);
    }
```

ê·¸ëŸ¬ë‚˜ ì´ì™¸ì˜ Controllerë“¤ì€ ë³€ê²½ë˜ì§€ ì•Šê³  ìœ„ì™€ ê°™ì´ í•œ ë²ˆ ë” í—¤ë”ì—ì„œ í† í°ì„ êº¼ë‚´ ê²€ì¦í•˜ëŠ” ë¡œì§ì´ ê·¸ëŒ€ë¡œ ë‚¨ì•„ìˆì—ˆê³ , ê·¸ ê²°ê³¼ ë¶ˆí•„ìš”í•œ ê²€ì¦ì´ 1ë²ˆ ë” ì¼ì–´ë‚¬ë˜ ê²ƒì´ì—ˆë‹¤.

## âœ… í•´ê²° ë°©ë²•

### shouldNotFilter

```java
    /**
     * íŠ¹ì • ê²½ë¡œì— ëŒ€í•´ JWT Filterë¥¼ ìƒëµí•©ë‹ˆë‹¤.
     *
     * @param request HTTP ìš”ì²­ ê°ì²´
     * @return trueì¼ ê²½ìš° í•´ë‹¹ ìš”ì²­ì— ëŒ€í•´ í•„í„°ë¥¼ ì ìš©í•˜ì§€ ì•ŠìŒ
     */
    @Override
    protected boolean shouldNotFilter(HttpServletRequest request) {
        String path = request.getServletPath();
        String method = request.getMethod();

        return path.startsWith("/api/v1/admin") ||
                path.startsWith("/api/v1/banners") ||
                path.startsWith("/api/v1/members") ||
                path.startsWith("/api/v1/tokens") ||
                path.startsWith("/api/v1/urls") ||

(ìƒëµ ..)

    }
```

í•„í„°ë¥¼ íƒ€ì§€ ì•Šì•„ë„ ë˜ëŠ” URIë“¤ì— ëŒ€í•´ì„œ ì§€ì •í•´ì£¼ì—ˆê³ , ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ Contextì— ìˆëŠ” ìœ ì € ê°ì²´ë¥¼ êº¼ë‚´ ì“°ë„ë¡ ë³€ê²½í•´ì£¼ì—ˆë‹¤.

## ğŸ’« ê²°ê³¼

![](https://velog.velcdn.com/images/hsh111366/post/8c072b03-e9ab-44e4-aa41-38498e06b59e/image.png)

ê·¸ ê²°ê³¼ JWT ê²€ì¦ì´ 1ë²ˆë§Œ ì´ë£¨ì–´ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤!
ë˜í•œ ì¶”ê°€ì ìœ¼ë¡œ JWT ê²€ì¦ ì„±ê³µì— ëŒ€í•œ ë¡œê·¸ëŠ” ë¶ˆí•„ìš”í•  ê²ƒ ê°™ì•„, ì˜ˆì™¸ ìƒí™©ì„ ì œì™¸í•˜ê³ ëŠ” ëª¨ë‘ ì œê±°í•´ì£¼ì—ˆë‹¤.

---

# ğŸ’£ ë¬¸ì œ4 - 500ì—ëŸ¬ë„ ë™ì¼í•˜ê²Œ ì¶œë ¥ë¨


![](https://velog.velcdn.com/images/hsh111366/post/ea5bc57b-d1a8-4681-829b-88ad94bb4d35/image.png)

ì´ë¯¸ì§€ë¥¼ ë³´ë©´ 500ì—ëŸ¬ ì„ì—ë„ ë¶ˆêµ¬í•˜ê³  ë™ì¼í•˜ê²Œ `ìš”ì²­ ì™„ë£Œ`ë¡œ ëœ¨ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

## âœ… í•´ê²° ë°©ë²• - íŒë³„ ë¡œì§ ì¶”ê°€

```java
    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        Long start = (Long) request.getAttribute(START_TIME);
        long duration = System.currentTimeMillis() - (start != null ? start : 0L);

        int status = response.getStatus();

        if (status >= 400) {
            log.error("âŒ [{}] {} request failed - {}ms | status={}", request.getMethod(), request.getRequestURI(), duration, status);
        } else {
            log.info("âœ… [{}] {} request completed - {}ms | status={}", request.getMethod(), request.getRequestURI(), duration, status);
        }
    }
```

ì´ë ‡ê²Œ `4xx ~ 5xx` ì—ëŸ¬ì¸ ê²½ìš° ìš”ì²­ ì‹¤íŒ¨ë¡œ í‘œì‹œí•˜ë„ë¡ ë¡œì§ì„ ì¶”ê°€í•˜ì˜€ë‹¤.

## ğŸ’« ê²°ê³¼

![](https://velog.velcdn.com/images/hsh111366/post/334d87b0-2925-4840-888d-838245765c13/image.png)

í•´ë‹¹ ì—ëŸ¬ëŠ” ì„œë¹„ìŠ¤ì— ë¬¸ì œë¥¼ ì•¼ê¸°í•  ìˆ˜ ìˆê¸°ì—, ì¶”í›„ ë””ìŠ¤ì½”ë“œë‚˜ ìŠ¬ë™ ë“±ìœ¼ë¡œ ë³´ë‚´ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

---

# ğŸ’£ ë¬¸ì œ5 - ìš”ì²­ ì •ë³´ê°€ ì—†ìŒ

í˜„ì¬ëŠ” ì–´ë– í•œ APIë¥¼ í˜¸ì¶œí–ˆëŠ”ì§€, ê·¸ë¦¬ê³  ì²˜ë¦¬ ì†ë„ê°€ ì–¼ë§ˆë‚˜ ë˜ëŠ”ì§€ ì •ë„ë§Œ ë¡œê¹…ì„ í•˜ê³  ìˆë‹¤.
ë§Œì•½ íŠ¹ì • ìƒí™©ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆê±°ë‚˜ ë³‘ëª©ì´ ìˆì„ ë•Œ, ì–´ë– í•œ ìš”ì²­ ê°’ìœ¼ë¡œ ë“¤ì–´ì™”ëŠ”ì§€ë¥¼ ëª¨ë¥¸ë‹¤ë©´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ì–´ë ¤ìš¸ ê²ƒì´ë‹¤.

ë•Œë¬¸ì— `Request Param, Request Body, PathVariable` ì„ ê°ê° ë¡œê¹…í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

## âœ… í•´ê²° ë°©ë²•

### ê°€. Request Param

ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì˜ ê²½ìš°ì—ëŠ” ì£¼ë¡œ GET ë©”ì„œë“œ í˜¸ì¶œì—ì„œ í™œìš©ëœë‹¤.

```java
    private Map<String, String> getRequestParams(HttpServletRequest request) {
        Map<String, String> paramMap = new HashMap<>();
        Enumeration<String> parameterNames = request.getParameterNames();

        while (parameterNames.hasMoreElements()) {
            String paramName = parameterNames.nextElement();
            paramMap.put(paramName, request.getParameter(paramName));
        }

        return paramMap;
    }
```

ìœ„ ë©”ì„œë“œë¥¼ LoggingInterceptor ë‚´ë¶€ì— ì¶”ê°€í•´ ì¤€ë‹¤.

ì´ëŠ” `HttpServletRequest`ì˜ `getParameterNames()`ì™€ `getParameter()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œí•´ì„œ Map í˜•íƒœë¡œ ì €ì¥í•´ì£¼ê¸°ì— ì´í›„ ë¡œê¹…ì— í™œìš©í•  ìˆ˜ ìˆë‹¤.

```java
        if (request.getParameterNames().hasMoreElements()) {
            log.info("ğŸ“¦ï¸ [{}] {} \nqueryParams : {}", request.getMethod(), request.getRequestURI(), getRequestParams(request));
        }
```

ë˜í•œ í•´ë‹¹ ì¡°ê±´ì„ `preHandle` ë©”ì„œë“œ ë‚´ë¶€ì— ì¶”ê°€í•œë‹¤. ì´ëŠ” íŒŒë¼ë¯¸í„°ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ ë™ì‘í•œë‹¤.


### ë‚˜. Request Body

> **â—ï¸ Request Bodyë¥¼ ë¡œê¹…í•  ë•Œ ì£¼ì˜í•  ì **
- HttpServletRequestì˜ Request BodyëŠ” í•œ ë²ˆ ì½ìœ¼ë©´ ë‹¤ì‹œ ì½ì„ ìˆ˜ ì—†ìŒ.
	-> ë‚´ë¶€ ìŠ¤íŠ¸ë¦¼ì€ í•œ ë²ˆ ì†Œë¹„ë˜ë©´ ì‚¬ë¼ì§€ê¸° ë•Œë¬¸!
- ì¦‰, Interceptorì—ì„œ Request Bodyë¥¼ ì½ì–´ ë¡œê¹…í•˜ë©´, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í•´ë‹¹ ë°”ë””ë¥¼ ë‹¤ì‹œ ì½ì„ ìˆ˜ ì—†ê²Œ ë˜ì–´ ì •ìƒì ì¸ ì²˜ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•´ ì§.

ë•Œë¬¸ì— `CustomHttpRequestWrapper`ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ë³¸ë¬¸ì„ ë¯¸ë¦¬ ìºì‹±í•´ ë‘ì–´ì•¼ í•œë‹¤.
Wrapper í´ë˜ìŠ¤ëŠ” Request Bodyë¥¼ ì—¬ëŸ¬ ë²ˆ ì½ì„ ìˆ˜ ìˆë„ë¡ InputStreamì„ ë‚´ë¶€ì ìœ¼ë¡œ ìºì‹±í•˜ì—¬ ê´€ë¦¬í•œë‹¤.

```java
import jakarta.servlet.ReadListener;
import jakarta.servlet.ServletInputStream;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletRequestWrapper;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.InputStream;

public class CustomHttpRequestWrapper extends HttpServletRequestWrapper {

    private final byte[] requestBody;

    public CustomHttpRequestWrapper(HttpServletRequest request) throws IOException {
        super(request);
        try (InputStream is = request.getInputStream(); ByteArrayOutputStream baos = new ByteArrayOutputStream()) {
            byte[] buffer = new byte[1024];
            int length;
            while ((length = is.read(buffer)) != -1) {
                baos.write(buffer, 0, length);
            }
            this.requestBody = baos.toByteArray();
        }
    }

    @Override
    public ServletInputStream getInputStream() {
        ByteArrayInputStream bais = new ByteArrayInputStream(this.requestBody);
        return new ServletInputStream() {
            @Override public int read() {
                return bais.read();
            }
            @Override public boolean isFinished() {
                return bais.available() == 0; 
            }
            @Override public boolean isReady() {
                return true; 
            }
            @Override public void setReadListener(ReadListener readListener) {
            }
        };
    }

    public byte[] getRequestBody() {
        return this.requestBody;
    }
}
```

ìœ„ í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ ì¤€ë‹¤.
í•´ë‹¹ í´ë˜ìŠ¤ëŠ” `HttpServletRequestWrapper`ë¥¼ ìƒì† ë°›ì•„ì„œ Request Bodyë¥¼ ì—¬ëŸ¬ ë²ˆ ì½ì„ ìˆ˜ ìˆë„ë¡ ì²˜ë¦¬í•´ ì¤€ë‹¤.

`this.requestBody = baos.toByteArray();` ì—¬ê¸°ì„œ ë‚´ë¶€ ìŠ¤íŠ¸ë¦¼ì„ 1ë²ˆ ì½ì€ í›„ì—, ë©”ëª¨ë¦¬ì— ë°”ì´íŠ¸ë°°ì—´ ë³µì‚¬ë³¸ì„ ì €ì¥í•´ ë‘”ë‹¤. ì´í›„ë¡œëŠ” í•„ìš” ì‹œ ë³µì‚¬ë³¸ì„ ê³„ì†í•´ì„œ ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.

```java
import jakarta.servlet.*;
import jakarta.servlet.http.HttpServletRequest;
import org.springframework.stereotype.Component;
import side.onetime.global.wrapper.CustomHttpRequestWrapper;

import java.io.IOException;

@Component
public class RequestWrapperFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        if (request instanceof HttpServletRequest httpRequest) {
            CustomHttpRequestWrapper wrapper = new CustomHttpRequestWrapper(httpRequest);
            chain.doFilter(wrapper, response);
        } else {
            chain.doFilter(request, response);
        }
    }
}

```

ìœ„ì—ì„œ ë§Œë“  `CustomHttpRequestWrapper` í´ë˜ìŠ¤ê°€ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ì„œ ì ìš©ë  ìˆ˜ ìˆë„ë¡ ìœ„ í•„í„°ë¥¼ ì¶”ê°€í•´ì„œ ì ìš©í•´ ì£¼ì.

í•´ë‹¹ í•„í„°ëŠ”
1) `javax.servlet.Filter`ë¥¼ êµ¬í˜„í–ˆê³ ,
2) `@Component`ê°€ ë¶™ì–´ ìˆì–´ì„œ `Spring Bean`ìœ¼ë¡œ ë“±ë¡ëœë‹¤.
ë”°ë¼ì„œ ë³„ë„ë¡œ í•„í„° ë“±ë¡ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

ë‹¨, ë“±ë¡ ìˆœì„œ ì¡°ì •ì´ë‚˜ í•„í„° ì ìš© URL ì§€ì •ì´ í•„ìš”í•  ê²½ìš°ì—ëŠ” `FilterRegistrationBean`ìœ¼ë¡œ ëª…ì‹œ ë“±ë¡ì´ í•„ìš”í•˜ë‹¤.

```java
        if (request instanceof CustomHttpRequestWrapper wrapper) {
            String body = new String(wrapper.getRequestBody());
            if (!body.isBlank()) {
                try {
                    ObjectMapper mapper = new ObjectMapper();
                    Object json = mapper.readValue(body, Object.class);
                    String prettyBody = mapper.writerWithDefaultPrettyPrinter().writeValueAsString(json);
                    log.info("ğŸ“¦ [{}] {} \nbody : {}", request.getMethod(), request.getRequestURI(), prettyBody);
                } catch (Exception e) {
                    log.info("ğŸ“¦ [{}] {} \nbody(raw) : {}", request.getMethod(), request.getRequestURI(), body);
                }
            }
        }
```

ë§ˆì§€ë§‰ìœ¼ë¡œ ìœ„ ë¶€ë¶„ì„ `preHandle` ë©”ì„œë“œ ë‚´ì— ì¶”ê°€í•œë‹¤.

### ë‹¤. PathVariable

```java
        if (handler instanceof HandlerMethod) {
            Map<String, String> pathVariables =
                    (Map<String, String>) request.getAttribute(HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE);
            if (pathVariables != null && !pathVariables.isEmpty()) {
                log.info("ğŸ“¦ [{}] {} \npathVars : {}", request.getMethod(), request.getRequestURI(), pathVariables);
            }
        }
```

ë§ˆì§€ë§‰ìœ¼ë¡œ PathVariableì€ `HandlerMethod`ë¥¼ í™•ì¸í•¨ìœ¼ë¡œì¨ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤. ìœ„ ë¶€ë¶„ì„ `preHandle` ë©”ì„œë“œ ë‚´ì— ì¶”ê°€í•œë‹¤.

### ë¼. preHandle

ìœ„ 3ê°€ì§€ë¥¼ ëª¨ë‘ ì ìš©í•œ `preHandle` ë©”ì„œë“œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

```java
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        if (handler instanceof HandlerMethod) {
            Map<String, String> pathVariables =
                    (Map<String, String>) request.getAttribute(HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE);
            if (pathVariables != null && !pathVariables.isEmpty()) {
                log.info("ğŸ“¦ [{}] {} \npathVars : {}", request.getMethod(), request.getRequestURI(), pathVariables);
            }
        }

        if (request.getParameterNames().hasMoreElements()) {
            log.info("ğŸ“¦ï¸ [{}] {} \nqueryParams : {}", request.getMethod(), request.getRequestURI(), getRequestParams(request));
        }

        if (request instanceof CustomHttpRequestWrapper wrapper) {
            String body = new String(wrapper.getRequestBody());
            if (!body.isBlank()) {
                try {
                    ObjectMapper mapper = new ObjectMapper();
                    Object json = mapper.readValue(body, Object.class);
                    String prettyBody = mapper.writerWithDefaultPrettyPrinter().writeValueAsString(json);
                    log.info("ğŸ“¦ [{}] {} \nbody : {}", request.getMethod(), request.getRequestURI(), prettyBody);
                } catch (Exception e) {
                    log.info("ğŸ“¦ [{}] {} \nbody(raw) : {}", request.getMethod(), request.getRequestURI(), body);
                }
            }
        }

        request.setAttribute("startTime", System.currentTimeMillis());
        return true;
    }
```


## ğŸ’« ê²°ê³¼

```
2025-05-03T05:31:18.089+09:00  INFO 88263 --- [nio-8090-exec-6] s.o.g.interceptor.LoggingInterceptor     : ğŸ“¦ï¸ [GET] /api/v1/admin/logging 
queryParams : {name=temp}
2025-05-03T05:31:18.095+09:00  INFO 88263 --- [nio-8090-exec-6] s.o.g.interceptor.LoggingInterceptor     : âœ… [GET] /api/v1/admin/logging request completed - 4ms | status=200
2025-05-03T05:31:26.955+09:00  INFO 88263 --- [nio-8090-exec-8] s.o.g.interceptor.LoggingInterceptor     : ğŸ“¦ [POST] /api/v1/admin/logging 
body : {
  "name" : "temp"
}
2025-05-03T05:31:26.965+09:00  INFO 88263 --- [nio-8090-exec-8] s.o.g.interceptor.LoggingInterceptor     : âœ… [POST] /api/v1/admin/logging request completed - 9ms | status=200
2025-05-03T05:31:30.481+09:00  INFO 88263 --- [nio-8090-exec-7] s.o.g.interceptor.LoggingInterceptor     : ğŸ“¦ [PATCH] /api/v1/admin/logging/1 
pathVars : {id=1}
2025-05-03T05:31:30.492+09:00  INFO 88263 --- [nio-8090-exec-7] s.o.g.interceptor.LoggingInterceptor     : âœ… [PATCH] /api/v1/admin/logging/1 request completed - 11ms | status=200

```

í…ŒìŠ¤íŠ¸ìš© APIë¥¼ ë§Œë“¤ê³  í˜¸ì¶œí•´ ë³´ë‹ˆ, ìœ„ì™€ ê°™ì´ 3ê°€ì§€ ê²½ìš° ëª¨ë‘ ì˜ ë¡œê¹…ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤!

---

# ğŸ ë§ˆë¬´ë¦¬

```
2025-05-03T05:23:19.179+09:00  INFO 1 --- [nio-8090-exec-4] s.o.g.interceptor.LoggingInterceptor     : ğŸ“¦ [GET] /api/v1/schedules/date/e7285da6-1d97-40cf-88d7-63c34285485e 
pathVars : {event_id=e7285da6-1d97-40cf-88d7-63c34285485e}
2025-05-03T05:23:19.947+09:00  INFO 1 --- [nio-8090-exec-4] s.o.g.interceptor.LoggingInterceptor     : âœ… [GET] /api/v1/schedules/date/e7285da6-1d97-40cf-88d7-63c34285485e request completed - 766ms | status=200
2025-05-03T05:23:20.087+09:00  INFO 1 --- [nio-8090-exec-5] s.o.g.interceptor.LoggingInterceptor     : ğŸ“¦ [GET] /api/v1/events/e7285da6-1d97-40cf-88d7-63c34285485e/most 
pathVars : {event_id=e7285da6-1d97-40cf-88d7-63c34285485e}
2025-05-03T05:23:20.156+09:00  INFO 1 --- [nio-8090-exec-5] s.o.g.interceptor.LoggingInterceptor     : âœ… [GET] /api/v1/events/e7285da6-1d97-40cf-88d7-63c34285485e/most request completed - 68ms | status=200
```

ìµœì¢…ì ìœ¼ë¡œ ìœ„ì™€ ê°™ì€ í˜•íƒœì˜ ë¡œê¹…ì„ ë³¼ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
ì•„ì§ ê°œì„ í•  ë¶€ë¶„ì´ ë§ì§€ë§Œ, ê·¸ë˜ë„ ì´ì „ì— ë¹„í•˜ë©´ ë§ì´ ë‚˜ì•„ì¡Œë‹¤ê³  ìƒê°í•œë‹¤.

## ëŠë‚€ ì 

1. ì´ì „ì—ëŠ” Filterì— ëŒ€í•œ ì´í•´ê°€ ê±°ì˜ ì—†ëŠ” ìƒíƒœë¡œ JwtFilterë¥¼ ë„ì…í–ˆë”ë‹ˆ, ê²€ì¦ì„ 2ë²ˆ í•˜ëŠ” ë¬¸ì œë„ ë°œìƒí–ˆë˜ ê²ƒ ê°™ë‹¤. ì•ìœ¼ë¡œëŠ” ë¬´ì—‡ì¸ê°€ë¥¼ ë„ì…í•˜ê¸° ì „ì— ë”ìš± ê¼¼ê¼¼íˆ ê³µë¶€ë¥¼ í•´ì•¼í•  ê²ƒ ê°™ë‹¤.
2. Spring Securityì— ëŒ€í•œ ê³µë¶€ë„ ë¯¸ë£¬ì§€ ëª‡ ë‹¬ ì§¸ì¸ë°, ì‹œê°„ì´ ë‚  ë•Œë§ˆë‹¤ ê³µë¶€ë¥¼ í•˜ë©´ì„œ ê°œì„ í•´ ë´ì•¼ê² ë‹¤.
3. ë°°í¬ & í…ŒìŠ¤íŠ¸ ì„œë²„ì—ì„œë„ SQLë¬¸ì´ ì¶œë ¥ë˜ë„ë¡ í•˜ëŠ” ë“±ì˜ ë¬¸ì œê°€ ìˆë˜ ê²ƒì„ ë³´ì•„, ì—¬ì „íˆ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•˜ëŠ” ê²ƒì— ëŒ€í•´ ë¯¸ìˆ™í•¨ì´ ë§ì€ ê²ƒ ê°™ë‹¤. ë” ë§ì´ ì•Œì•„ë³´ê³  ê³µë¶€í•´ ë³´ì.
3. ë¡œê¹… -> ëª¨ë‹ˆí„°ë§ -> ì„±ëŠ¥ ê°œì„ ì˜ ì‚¬ì´í´ì´ ìˆëŠ” ê²ƒ ê°™ë‹¤. ë¡œê¹…ì„ ë¹ ë¥´ê²Œ ë§ˆë¬´ë¦¬ í•˜ê³  ëª¨ë‹ˆí„°ë§ì„ ì‹œì‘í•´ì•¼ê² ë‹¤.

## ì•ìœ¼ë¡œ í•´ì•¼í•  ì¼

1. ìš”ì²­ ë³„ë¡œ ê³ ìœ ê°’ ì§€ì •í•˜ì—¬ ë¹ ë¥¸ ê²€ìƒ‰ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸°
2. LogBack ë„ì…í•˜ì—¬ ë¡œê·¸ ë”ìš± ê°œì„ í•˜ê¸°
3. AWS Cloud Watch ë„ì… -> ì—ëŸ¬ íŒŒì•…í•˜ì—¬ ë””ìŠ¤ì½”ë“œë¡œ ì—°ë™í•˜ê¸°
4. ë³‘ëª© ì§€ì  ì°¾ì•„ì„œ ì„±ëŠ¥ ê°œì„ í•˜ê¸°

---

### ì°¸ê³ í•œ ë¸”ë¡œê·¸

https://velog.io/@dongjae0803/Spring-Boot-ë¡œê·¸-ê´€ë¦¬-ì˜í•˜ê³ -ê³„ì‹ ê°€ìš”-Logging
